<!doctype html>
<html lang="en" ng-app="ffConsole">
<head>
  <meta charset="utf-8">
  <title>The FatFractal FYI Test Harness</title>
  <script type="text/javascript">
    function httpsRedirect() {
      var httpURL = window.location.hostname + window.location.pathname;
      var httpsURL = "https://" + httpURL;
      window.location = httpsURL;
    }
    console.log(window.location.href);
    console.log(!window.location.href.match('^https://') && !window.location.href.match('^http://localhost'));
    if (!window.location.href.match('^https://') && !window.location.href.match('^http://localhost'))
      httpsRedirect();
  </script>
  <link rel="stylesheet" href="css/app.css"/>
  <link href="lib/ui-bootstrap/assets/bootstrap.css" rel="stylesheet" media="screen">
</head>
<!--
<body onunload="cleanUp()">
-->
<body>
<div id="navbar" class="navbar" ng-controller="LoginCtrl">
  <div class="navbar-inner">
    <img src="img/beta.png" width="240px" class="brand pull-left">
    <h1 style="margin: 20px -20px">Test Harness</h1>
    <div class="span4" ui-if="refreshing" ng-cloak spinner style="margin: 20px -20px"></div>
    <div class="pull-right">
      <p class="navbar-text">
        <span id="loggedInUserName" style="margin-right:5px;"></span>
        <button class="btn" id="logoutButton" onclick="logout()">Logout</button>
      </p>
    </div>
  </div>
</div>
<div class="well">
  <h1>FYI - Scriptauth OAuth authentication system from FatFractal</h1>
  <p>This post demonstrates real examples authenticating users with various Oauth authentication providers on FatFractal.
  </p>
  <div class="well">
    <h3>Login using Facebook</h3>
      <button id="facebook-login-button" class="btn btn-primary" onclick="facebookLogin()">Facebook Login</button>
  </div>
  <div class="well">
    <h3>Login using Twitter</h3>
      <button id="twitter-login-button" class="btn btn-primary" onclick="twitterLogin()">Twitter Login</button>
  </div>
  <div class="well">
    <h3>Check it</h3>
    <p>You can verify that you are logged in by clicking "Save me!" below. This will create 
       an object on the backend and report back the results. If not, you will get an error.
    </p>
    <div class="well">
      <p>function Movie() {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;this.title = null;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;this.description = null;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;this.year = null;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;return this;<br>
        }
      </p>
    </div>
    <button id="new-movie-movies-button" class="btn" onclick="saveMovie()">Save me!</button>
    <p><br>
      Note - since you can only create objects on a FatFractal backend with a logged in user, a successful 
      save will demonstrate that you have successfully logged in using Twitter or Facebook.      
    </p>
    <br>
    <p id = "movie-movies-response"></p>
  </div>
</div>
<!--Scripts-->
<script src="lib/FatFractal.js"></script>
<script src="js/app.js"></script>
<script src="js/utils.js"></script>
<script src="js/beautify.js"></script>
<script type="text/javascript">
  if(ff.loggedIn()) {
    console.log("starting up - loggedIn = true");
    var el = document.getElementById("loggedInUserName");
    var bel = document.getElementById("logoutButton");
    el.innerHTML = "Logged in as " + ff.loggedInUser().firstName + " " + ff.loggedInUser().lastName;
    bel.style.display = "visible";
  } else {
    console.log("starting up - loggedIn = false");
    var bel = document.getElementById("logoutButton");
    bel.style.display = "none";
  }
</script>
</body>
</html>
